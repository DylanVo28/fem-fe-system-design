<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Observer API Demo - Intersection, Mutation & Resize Observer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .demo-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }

        .demo-section:hover {
            transform: translateY(-5px);
        }

        .demo-title {
            font-size: 1.8rem;
            color: #4a5568;
            margin-bottom: 20px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .demo-description {
            margin-bottom: 20px;
            color: #666;
            font-size: 1.1rem;
        }

        /* Intersection Observer Demo */
        .lazy-section {
            height: 300px;
            margin: 20px 0;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            opacity: 0;
            transform: translateY(50px);
            transition: all 0.6s ease;
        }

        .lazy-section.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .lazy-section:nth-child(2) {
            background: linear-gradient(45deg, #a8edea, #fed6e3);
            color: #333;
        }

        .lazy-section:nth-child(3) {
            background: linear-gradient(45deg, #ffecd2, #fcb69f);
            color: #333;
        }

        /* Mutation Observer Demo */
        .text-editor {
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            min-height: 200px;
            font-size: 1.1rem;
            line-height: 1.8;
            background: #f8fafc;
            transition: border-color 0.3s ease;
        }

        .text-editor:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .mutation-log {
            background: #1a202c;
            color: #68d391;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .mutation-log .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }

        .mutation-log .log-entry.added {
            color: #68d391;
        }

        .mutation-log .log-entry.removed {
            color: #fc8181;
        }

        .mutation-log .log-entry.modified {
            color: #f6e05e;
        }

        /* Resize Observer Demo */
        .resize-container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .resize-box {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            min-width: 200px;
            min-height: 150px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .resize-box:hover {
            transform: scale(1.05);
        }

        .resize-info {
            text-align: center;
            margin-top: 10px;
        }

        .resize-info .size {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .resize-info .change {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .resize-controls {
            margin-top: 20px;
            text-align: center;
        }

        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 5px;
            font-size: 1rem;
            transition: background 0.3s ease;
        }

        .btn:hover {
            background: #5a67d8;
        }

        .btn:active {
            transform: translateY(1px);
        }

        /* Performance Comparison */
        .performance-demo {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .performance-title {
            font-size: 1.3rem;
            color: #4a5568;
            margin-bottom: 15px;
        }

        .performance-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }

        .metric {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .metric-title {
            font-weight: bold;
            color: #4a5568;
            margin-bottom: 5px;
        }

        .metric-value {
            font-size: 1.5rem;
            color: #667eea;
            font-weight: bold;
        }

        /* Scroll indicator */
        .scroll-indicator {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: rgba(102, 126, 234, 0.3);
            z-index: 1000;
        }

        .scroll-progress {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.1s ease;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .demo-section {
                padding: 20px;
            }

            .resize-container {
                flex-direction: column;
            }

            .performance-metrics {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="scroll-indicator">
        <div class="scroll-progress" id="scrollProgress"></div>
    </div>

    <div class="container">
        <div class="header">
            <h1>üîç Observer API Demo</h1>
            <p>Kh√°m ph√° s·ª©c m·∫°nh c·ªßa IntersectionObserver, MutationObserver v√† ResizeObserver</p>
        </div>

        <!-- Intersection Observer Demo -->
        <div class="demo-section">
            <h2 class="demo-title">üéØ IntersectionObserver - Lazy Loading & Animation</h2>
            <p class="demo-description">
                IntersectionObserver gi√∫p ph√°t hi·ªán khi ph·∫ßn t·ª≠ xu·∫•t hi·ªán trong viewport. 
                Hi·ªáu su·∫•t cao h∆°n 50 l·∫ßn so v·ªõi c√°ch th·ªß c√¥ng!
            </p>
            
            <div class="lazy-section" data-lazy="1">
                <div>üé® Section 1 - Xu·∫•t hi·ªán v·ªõi hi·ªáu ·ª©ng m∆∞·ª£t m√†</div>
            </div>
            
            <div class="lazy-section" data-lazy="2">
                <div>üöÄ Section 2 - Lazy loading ho·∫°t ƒë·ªông</div>
            </div>
            
            <div class="lazy-section" data-lazy="3">
                <div>‚ö° Section 3 - Hi·ªáu su·∫•t t·ªëi ∆∞u</div>
            </div>
        </div>

        <!-- Mutation Observer Demo -->
        <div class="demo-section">
            <h2 class="demo-title">üîÑ MutationObserver - Theo d√µi thay ƒë·ªïi DOM</h2>
            <p class="demo-description">
                MutationObserver theo d√µi m·ªçi thay ƒë·ªïi trong DOM subtree. 
                H·ªØu √≠ch cho text editors v√† ·ª©ng d·ª•ng real-time.
            </p>
            
            <div contenteditable="true" class="text-editor" id="textEditor">
                H√£y th·ª≠ ch·ªânh s·ª≠a n·ªôi dung n√†y! MutationObserver s·∫Ω theo d√µi m·ªçi thay ƒë·ªïi...
                <br><br>
                üí° Th·ª≠ th√™m, x√≥a, ho·∫∑c thay ƒë·ªïi vƒÉn b·∫£n ƒë·ªÉ xem log b√™n d∆∞·ªõi.
            </div>
            
            <div class="mutation-log" id="mutationLog">
                <div class="log-entry">üîç MutationObserver ƒëang theo d√µi...</div>
            </div>
        </div>

        <!-- Resize Observer Demo -->
        <div class="demo-section">
            <h2 class="demo-title">üìè ResizeObserver - Theo d√µi thay ƒë·ªïi k√≠ch th∆∞·ªõc</h2>
            <p class="demo-description">
                ResizeObserver theo d√µi vi·ªác thay ƒë·ªïi k√≠ch th∆∞·ªõc ph·∫ßn t·ª≠. 
                L√Ω t∆∞·ªüng cho responsive UI v√† charts.
            </p>
            
            <div class="resize-container">
                <div class="resize-box" id="resizeBox1">
                    <div>üìä Box 1</div>
                    <div class="resize-info">
                        <div class="size" id="size1">200x150px</div>
                        <div class="change" id="change1">Ch∆∞a thay ƒë·ªïi</div>
                    </div>
                </div>
                
                <div class="resize-box" id="resizeBox2">
                    <div>üìà Box 2</div>
                    <div class="resize-info">
                        <div class="size" id="size2">200x150px</div>
                        <div class="change" id="change2">Ch∆∞a thay ƒë·ªïi</div>
                    </div>
                </div>
            </div>
            
            <div class="resize-controls">
                <button class="btn" onclick="resizeBox(1, 'small')">Thu nh·ªè Box 1</button>
                <button class="btn" onclick="resizeBox(1, 'large')">Ph√≥ng to Box 1</button>
                <button class="btn" onclick="resizeBox(2, 'small')">Thu nh·ªè Box 2</button>
                <button class="btn" onclick="resizeBox(2, 'large')">Ph√≥ng to Box 2</button>
            </div>
        </div>

        <!-- Performance Comparison -->
        <div class="demo-section">
            <h2 class="demo-title">‚ö° So s√°nh hi·ªáu su·∫•t</h2>
            <p class="demo-description">
                Observer API vs c√°ch th·ªß c√¥ng (setInterval + getBoundingClientRect)
            </p>
            
            <div class="performance-demo">
                <div class="performance-title">K·∫øt qu·∫£ ki·ªÉm tra hi·ªáu su·∫•t:</div>
                <div class="performance-metrics">
                    <div class="metric">
                        <div class="metric-title">Observer API</div>
                        <div class="metric-value" id="observerTime">0ms</div>
                    </div>
                    <div class="metric">
                        <div class="metric-title">C√°ch th·ªß c√¥ng</div>
                        <div class="metric-value" id="manualTime">0ms</div>
                    </div>
                </div>
                <button class="btn" onclick="runPerformanceTest()" style="margin-top: 15px;">
                    üèÉ‚Äç‚ôÇÔ∏è Ch·∫°y ki·ªÉm tra hi·ªáu su·∫•t
                </button>
            </div>
        </div>
    </div>

    <script>
        // Intersection Observer Demo
        const intersectionObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                    console.log(`üéØ Element ${entry.target.dataset.lazy} is now visible!`);
                }
            });
        }, {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        });

        // Observe all lazy sections
        document.querySelectorAll('.lazy-section').forEach(section => {
            intersectionObserver.observe(section);
        });

        // Mutation Observer Demo
        const mutationObserver = new MutationObserver((mutations) => {
            const log = document.getElementById('mutationLog');
            
            mutations.forEach(mutation => {
                const logEntry = document.createElement('div');
                logEntry.className = 'log-entry';
                
                if (mutation.type === 'childList') {
                    if (mutation.addedNodes.length > 0) {
                        logEntry.className += ' added';
                        logEntry.textContent = `‚ûï Added ${mutation.addedNodes.length} node(s)`;
                    }
                    if (mutation.removedNodes.length > 0) {
                        logEntry.className += ' removed';
                        logEntry.textContent = `‚ûñ Removed ${mutation.removedNodes.length} node(s)`;
                    }
                } else if (mutation.type === 'characterData') {
                    logEntry.className += ' modified';
                    logEntry.textContent = `‚úèÔ∏è Text modified: "${mutation.target.textContent.substring(0, 30)}..."`;
                } else if (mutation.type === 'attributes') {
                    logEntry.className += ' modified';
                    logEntry.textContent = `üîß Attribute changed: ${mutation.attributeName}`;
                }
                
                if (logEntry.textContent) {
                    log.appendChild(logEntry);
                    log.scrollTop = log.scrollHeight;
                }
            });
        });

        // Start observing the text editor
        const textEditor = document.getElementById('textEditor');
        mutationObserver.observe(textEditor, {
            childList: true,
            subtree: true,
            characterData: true,
            attributes: true,
            attributeOldValue: true,
            characterDataOldValue: true
        });

        // Resize Observer Demo
        const resizeObserver = new ResizeObserver((entries) => {
            entries.forEach(entry => {
                const boxId = entry.target.id.replace('resizeBox', '');
                const sizeElement = document.getElementById(`size${boxId}`);
                const changeElement = document.getElementById(`change${boxId}`);
                
                const { width, height } = entry.contentRect;
                const newSize = `${Math.round(width)}x${Math.round(height)}px`;
                
                sizeElement.textContent = newSize;
                changeElement.textContent = `üîÑ Resized at ${new Date().toLocaleTimeString()}`;
                changeElement.style.color = '#667eea';
                
                console.log(`üìè Box ${boxId} resized to ${newSize}`);
            });
        });

        // Observe both resize boxes
        document.querySelectorAll('[id^="resizeBox"]').forEach(box => {
            resizeObserver.observe(box);
        });

        // Resize control functions
        function resizeBox(boxNumber, size) {
            const box = document.getElementById(`resizeBox${boxNumber}`);
            const currentWidth = box.offsetWidth;
            const currentHeight = box.offsetHeight;
            
            if (size === 'small') {
                box.style.width = Math.max(150, currentWidth - 50) + 'px';
                box.style.height = Math.max(100, currentHeight - 30) + 'px';
            } else {
                box.style.width = (currentWidth + 50) + 'px';
                box.style.height = (currentHeight + 30) + 'px';
            }
        }

        // Scroll progress indicator
        const scrollProgress = document.getElementById('scrollProgress');
        window.addEventListener('scroll', () => {
            const scrollTop = window.pageYOffset;
            const docHeight = document.body.offsetHeight - window.innerHeight;
            const scrollPercent = (scrollTop / docHeight) * 100;
            scrollProgress.style.width = scrollPercent + '%';
        });

        // Performance comparison
        function runPerformanceTest() {
            const observerTimeElement = document.getElementById('observerTime');
            const manualTimeElement = document.getElementById('manualTime');
            
            // Test Observer API
            const observerStart = performance.now();
            const testObserver = new IntersectionObserver(() => {});
            const testElement = document.createElement('div');
            testObserver.observe(testElement);
            testObserver.disconnect();
            const observerEnd = performance.now();
            
            // Test manual method
            const manualStart = performance.now();
            for (let i = 0; i < 1000; i++) {
                const rect = testElement.getBoundingClientRect();
                const isVisible = rect.top < window.innerHeight && rect.bottom > 0;
            }
            const manualEnd = performance.now();
            
            observerTimeElement.textContent = `${(observerEnd - observerStart).toFixed(2)}ms`;
            manualTimeElement.textContent = `${(manualEnd - manualStart).toFixed(2)}ms`;
            
            console.log('üèÅ Performance test completed!');
            console.log(`Observer API: ${(observerEnd - observerStart).toFixed(2)}ms`);
            console.log(`Manual method: ${(manualEnd - manualStart).toFixed(2)}ms`);
        }

        // Initialize performance test on load
        setTimeout(runPerformanceTest, 1000);

        // Console welcome message
        console.log(`
        üéâ Observer API Demo ƒë√£ s·∫µn s√†ng!
        
        üìã C√°c t√≠nh nƒÉng c√≥ s·∫µn:
        ‚Ä¢ IntersectionObserver: Lazy loading v√† animation
        ‚Ä¢ MutationObserver: Theo d√µi thay ƒë·ªïi DOM
        ‚Ä¢ ResizeObserver: Theo d√µi thay ƒë·ªïi k√≠ch th∆∞·ªõc
        ‚Ä¢ So s√°nh hi·ªáu su·∫•t v·ªõi c√°ch th·ªß c√¥ng
        
        üí° M·ªü Developer Tools ƒë·ªÉ xem log chi ti·∫øt!
        `);
    </script>
</body>
</html>
