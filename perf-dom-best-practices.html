<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üöÄ Performance Best Practices trong DOM Manipulation</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    .container { max-width: 900px; margin: 0 auto; padding: 24px; }
    h1 { font-size: 28px; margin-bottom: 16px; }
    h2 { font-size: 20px; margin-top: 20px; }
    .tip { background: #f6f7f9; border: 1px solid #e5e7eb; padding: 12px 14px; border-radius: 8px; }
    code, kbd { background: #f3f4f6; padding: 0 4px; border-radius: 4px; }
    ul { margin: 8px 0 16px; padding-left: 20px; }
    li { margin: 6px 0; }
    /* Demo styles */
    .demo { border: 1px solid #e5e7eb; border-radius: 10px; padding: 16px; margin: 16px 0; background: #fff; }
    .demo h3 { margin: 0 0 8px; font-size: 16px; }
    .demo-controls { display: flex; gap: 8px; flex-wrap: wrap; margin: 10px 0; }
    .demo-controls button { padding: 8px 10px; border: 1px solid #d1d5db; background: #f9fafb; border-radius: 8px; cursor: pointer; }
    .demo-controls button:hover { background: #f3f4f6; }
    .output { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; background: #0b1020; color: #e5e7eb; border-radius: 8px; padding: 10px; min-height: 40px; white-space: pre-wrap; }
    .grid { display: grid; grid-template-columns: repeat(6, minmax(0, 1fr)); gap: 6px; }
    .cell { height: 18px; border-radius: 3px; }
    .cell.a { background: #bfdbfe; }
    .cell.b { background: #fca5a5; }
    .muted { color: #6b7280; font-size: 12px; }
  </style>
  <meta name="description" content="C√°c best practices v·ªÅ hi·ªáu nƒÉng khi thao t√°c DOM: t·ªëi ∆∞u query selector, d√πng ID ƒë√∫ng c√°ch, hi·ªÉu chi ph√≠ compile CSS selector, v√† k·ªπ thu·∫≠t th√™m/x√≥a DOM hi·ªáu qu·∫£." />
</head>
<body>
  <main class="container">
    <h1>üöÄ Performance Best Practices trong DOM Manipulation</h1>

    <section>
      <h2>1. T·ªëi ∆∞u query selector</h2>
      <p>Selector c√†ng ph·ª©c t·∫°p ‚Üí c√†ng t·ªën th·ªùi gian (do CSS selector ph·∫£i compile).</p>
      <p>M·ªôt query ph·ª©c t·∫°p c√≥ th·ªÉ ch·ªâ t·ªën v√†i ms, nh∆∞ng n·∫øu l·∫∑p h√†ng trƒÉm l·∫ßn ‚Üí c·ªông d·ªìn g√¢y ch·∫≠m.</p>
      <div class="tip">
        <strong>Best practice:</strong> d√πng selector ƒë∆°n gi·∫£n nh·∫•t c√≥ th·ªÉ.
      </div>
    </section>

    <section>
      <h2>2. S·ª≠ d·ª•ng ID ƒë√∫ng c√°ch</h2>
      <ul>
        <li>ID kh√¥ng n√™n l·∫°m d·ª•ng, nh∆∞ng c√≥ th·ªÉ r·∫•t h·ªØu √≠ch khi DOM tree l·ªõn (10,000+ elements).</li>
        <li>D√πng ID ƒë·ªÉ l·∫•y <em>root</em> nh·ªè h∆°n ‚Üí sau ƒë√≥ query con t·ª´ node n√†y ‚Üí gi·∫£m chi ph√≠ t√¨m ki·∫øm.</li>
      </ul>
      <div class="tip">
        V√≠ d·ª•: <code>const root = document.getElementById('list-root')</code> r·ªìi <code>root.querySelectorAll('.item')</code>.
      </div>
    </section>

    <section>
      <h2>3. Framework (React, Angular, Vue)</h2>
      <p>Khi d√πng framework ‚Üí tin c·∫≠y v√†o c∆° ch·∫ø DOM management c·ªßa framework.</p>
      <p>Ch·ªâ n√™n t·ªëi ∆∞u DOM API th·ªß c√¥ng ·ªü ch·ªó th·∫≠t c·∫ßn (v√≠ d·ª• trong React <code>useEffect</code> khi c·∫ßn query tr·ª±c ti·∫øp).</p>
    </section>

    <section>
      <h2>4. Chi ph√≠ compile CSS selectors</h2>
      <ul>
        <li><strong>CSS file</strong>: compile m·ªôt l·∫ßn khi load page.</li>
        <li><strong>Query Selector trong JS</strong>: compile m·ªói l·∫ßn ch·∫°y ‚Üí b·∫°n tr·∫£ chi ph√≠ l·∫∑p ƒëi l·∫∑p l·∫°i.</li>
      </ul>
    </section>

    <section>
      <h2>5. Thao t√°c th√™m/x√≥a ph·∫ßn t·ª≠ DOM</h2>
      <p>B·∫•t k·ª≥ thay ƒë·ªïi DOM ƒë·ªÅu g√¢y reflow ‚Üí t·ªën hi·ªáu nƒÉng.</p>
      <ul>
        <li><code>innerHTML</code>: parse l·∫°i to√†n b·ªô HTML, g√¢y reflow n·∫∑ng ‚Üí ch·ªâ n√™n d√πng 1 l·∫ßn khi init.</li>
        <li><code>insertAdjacentElement</code>: t·ªët h∆°n v√¨ nh·∫≠n s·∫µn compiled HTML element ‚Üí √≠t t·ªën chi ph√≠.
          <ul>
            <li><code>beforebegin</code>: tr∆∞·ªõc target element.</li>
            <li><code>afterbegin</code>: th√†nh ph·∫ßn con ƒë·∫ßu ti√™n.</li>
            <li><code>beforeend</code>: th√†nh ph·∫ßn con cu·ªëi c√πng.</li>
            <li><code>afterend</code>: sau target element.</li>
          </ul>
        </li>
        <li><code>append()</code> / <code>appendChild()</code>: th√™m element ƒë√£ ƒë∆∞·ª£c t·∫°o s·∫µn ‚Üí hi·ªáu qu·∫£ h∆°n <code>innerHTML</code>.</li>
        <li><code>remove()</code>: xo√° element b·∫±ng reference.</li>
        <li>Set <code>innerHTML = ""</code>: reset to√†n b·ªô n·ªôi dung.</li>
      </ul>
    </section>

    <section>
      <h2>üëâ K·∫øt lu·∫≠n ng·∫Øn g·ªçn</h2>
      <ul>
        <li><strong>Query</strong>: d√πng selector ƒë∆°n gi·∫£n, c√≥ th·ªÉ d√πng ID l√†m root ƒë·ªÉ h·∫°n ch·∫ø ph·∫°m vi.</li>
        <li><strong>DOM thay ƒë·ªïi</strong>: tr√°nh l·∫°m d·ª•ng <code>innerHTML</code>, ∆∞u ti√™n <code>insertAdjacentElement</code> ho·∫∑c <code>append</code>.</li>
        <li><strong>Framework</strong>: h·∫ßu h·∫øt ƒë√£ t·ªëi ∆∞u, ch·ªâ c·∫ßn can thi·ªáp khi b·∫Øt bu·ªôc.</li>
      </ul>
    </section>

    <section>
      <h2>6. V√≠ d·ª• minh ho·∫° (c√≥ th·ªÉ ch·∫°y)</h2>

      <div class="demo" id="demo-query">
        <h3>A) Query selector: ph·ª©c t·∫°p vs. ƒë∆°n gi·∫£n, v√† d√πng ID l√†m root</h3>
        <p class="muted">Sinh d·ªØ li·ªáu gi·∫£ l·∫≠p 12,000 √¥. ƒêo th·ªùi gian c√°c ki·ªÉu query.</p>
        <div class="demo-controls">
          <button id="btn-build-query">Sinh d·ªØ li·ªáu</button>
          <button id="btn-qsa-simple" disabled>querySelectorAll('.cell.a')</button>
          <button id="btn-qsa-complex" disabled>querySelectorAll('#query-root .grid .cell.a')</button>
          <button id="btn-scope-id" disabled>root.querySelectorAll('.cell.a')</button>
          <button id="btn-gecls" disabled>getElementsByClassName('a')</button>
          <button id="btn-clear-query" disabled>Xo√° d·ªØ li·ªáu</button>
        </div>
        <div id="query-root" class="demo-canvas"></div>
        <div class="output" id="out-query"></div>
      </div>

      <div class="demo" id="demo-dom">
        <h3>B) Th√™m nhi·ªÅu ph·∫ßn t·ª≠: innerHTML vs. DocumentFragment.append vs. insertAdjacentElement</h3>
        <p class="muted">Render 5,000 ph·∫ßn t·ª≠ m·ªói l∆∞·ª£t. So s√°nh th·ªùi gian.</p>
        <div class="demo-controls">
          <button id="btn-innerhtml">innerHTML (1 l·∫ßn)</button>
          <button id="btn-fragment">DocumentFragment + append</button>
          <button id="btn-insert-adjacent">insertAdjacentElement (v√≤ng l·∫∑p)</button>
          <button id="btn-clear-dom">Xo√°</button>
        </div>
        <div id="dom-root" class="demo-canvas"></div>
        <div class="output" id="out-dom"></div>
      </div>

      <div class="demo" id="demo-remove">
        <h3>C) Xo√° ph·∫ßn t·ª≠: remove() vs. innerHTML = ""</h3>
        <div class="demo-controls">
          <button id="btn-build-remove">Sinh 10,000 ph·∫ßn t·ª≠</button>
          <button id="btn-remove-ref" disabled>remove() t·ª´ng ph·∫ßn t·ª≠</button>
          <button id="btn-remove-clear" disabled>innerHTML = ""</button>
        </div>
        <div id="remove-root" class="demo-canvas"></div>
        <div class="output" id="out-remove"></div>
      </div>
    </section>
  </main>
  <script>
    // Utils
    function time(label, fn) {
      const start = performance.now();
      const result = fn();
      const end = performance.now();
      return { label, ms: +(end - start).toFixed(2), result };
    }

    function logAppend(element, lines) {
      const text = Array.isArray(lines) ? lines.join('\n') : String(lines);
      element.textContent = (element.textContent ? element.textContent + '\n' : '') + text;
    }

    // A) Query selector demo
    (function() {
      const out = document.getElementById('out-query');
      const root = document.getElementById('query-root');
      const btnBuild = document.getElementById('btn-build-query');
      const btnSimple = document.getElementById('btn-qsa-simple');
      const btnComplex = document.getElementById('btn-qsa-complex');
      const btnScope = document.getElementById('btn-scope-id');
      const btnGECls = document.getElementById('btn-gecls');
      const btnClear = document.getElementById('btn-clear-query');

      function buildCells() {
        // 12,000 cells: 2000 rows x 6 columns
        const fragment = document.createDocumentFragment();
        for (let r = 0; r < 2000; r++) {
          const row = document.createElement('div');
          row.className = 'grid';
          for (let c = 0; c < 6; c++) {
            const cell = document.createElement('div');
            const isA = ((r + c) % 2) === 0;
            cell.className = 'cell ' + (isA ? 'a' : 'b');
            row.appendChild(cell);
          }
          fragment.appendChild(row);
        }
        root.appendChild(fragment);
      }

      btnBuild.addEventListener('click', () => {
        out.textContent = '';
        root.innerHTML = '';
        const { ms } = time('build', buildCells);
        logAppend(out, `Sinh d·ªØ li·ªáu: ${ms} ms`);
        [btnSimple, btnComplex, btnScope, btnGECls, btnClear].forEach(b => b.disabled = false);
      });

      btnSimple.addEventListener('click', () => {
        const { ms, result } = time("qsa('.cell.a')", () => root.ownerDocument.querySelectorAll('.cell.a').length);
        logAppend(out, `querySelectorAll('.cell.a'): ${ms} ms (k·∫øt qu·∫£: ${result})`);
      });

      btnComplex.addEventListener('click', () => {
        const { ms, result } = time("qsa('#query-root .grid .cell.a')", () => root.ownerDocument.querySelectorAll('#query-root .grid .cell.a').length);
        logAppend(out, `'#query-root .grid .cell.a': ${ms} ms (k·∫øt qu·∫£: ${result})`);
      });

      btnScope.addEventListener('click', () => {
        const { ms, result } = time("root.qsa('.cell.a')", () => root.querySelectorAll('.cell.a').length);
        logAppend(out, `root.querySelectorAll('.cell.a'): ${ms} ms (k·∫øt qu·∫£: ${result})`);
      });

      btnGECls.addEventListener('click', () => {
        const { ms, result } = time("getElementsByClassName('a')", () => root.getElementsByClassName('a').length);
        logAppend(out, `getElementsByClassName('a'): ${ms} ms (k·∫øt qu·∫£: ${result})`);
      });

      btnClear.addEventListener('click', () => {
        root.innerHTML = '';
        logAppend(out, 'ƒê√£ xo√° d·ªØ li·ªáu.');
        [btnSimple, btnComplex, btnScope, btnGECls, btnClear].forEach(b => b.disabled = true);
      });
    })();

    // B) DOM insert demo
    (function() {
      const COUNT = 5000;
      const out = document.getElementById('out-dom');
      const root = document.getElementById('dom-root');
      const btnInner = document.getElementById('btn-innerhtml');
      const btnFrag = document.getElementById('btn-fragment');
      const btnInsert = document.getElementById('btn-insert-adjacent');
      const btnClear = document.getElementById('btn-clear-dom');

      function buildHTMLString(n) {
        let html = '';
        for (let i = 0; i < n; i++) {
          html += '<div class="cell a"></div>';
        }
        return '<div class="grid">' + html + '</div>';
      }

      btnInner.addEventListener('click', () => {
        root.innerHTML = '';
        const { ms } = time('innerHTML', () => {
          root.innerHTML = buildHTMLString(COUNT);
        });
        out.textContent = `innerHTML (m·ªôt l·∫ßn): ${ms} ms`;
      });

      btnFrag.addEventListener('click', () => {
        root.innerHTML = '';
        const { ms } = time('fragment', () => {
          const fragment = document.createDocumentFragment();
          const grid = document.createElement('div');
          grid.className = 'grid';
          for (let i = 0; i < COUNT; i++) {
            const cell = document.createElement('div');
            cell.className = 'cell a';
            grid.appendChild(cell);
          }
          fragment.appendChild(grid);
          root.appendChild(fragment);
        });
        out.textContent = `DocumentFragment + append: ${ms} ms`;
      });

      btnInsert.addEventListener('click', () => {
        root.innerHTML = '';
        const { ms } = time('insertAdjacentElement', () => {
          const grid = document.createElement('div');
          grid.className = 'grid';
          root.appendChild(grid);
          for (let i = 0; i < COUNT; i++) {
            const cell = document.createElement('div');
            cell.className = 'cell a';
            grid.insertAdjacentElement('beforeend', cell);
          }
        });
        out.textContent = `insertAdjacentElement (v√≤ng l·∫∑p): ${ms} ms`;
      });

      btnClear.addEventListener('click', () => {
        root.innerHTML = '';
        out.textContent = 'ƒê√£ xo√°.';
      });
    })();

    // C) Remove demo
    (function() {
      const out = document.getElementById('out-remove');
      const root = document.getElementById('remove-root');
      const btnBuild = document.getElementById('btn-build-remove');
      const btnRemoveRef = document.getElementById('btn-remove-ref');
      const btnRemoveClear = document.getElementById('btn-remove-clear');

      function build(n) {
        const fragment = document.createDocumentFragment();
        for (let i = 0; i < n; i++) {
          const el = document.createElement('div');
          el.className = 'cell b';
          fragment.appendChild(el);
        }
        root.appendChild(fragment);
      }

      btnBuild.addEventListener('click', () => {
        out.textContent = '';
        root.innerHTML = '';
        const { ms } = time('build-10k', () => build(10000));
        out.textContent = `Sinh 10,000 ph·∫ßn t·ª≠: ${ms} ms`;
        btnRemoveRef.disabled = false;
        btnRemoveClear.disabled = false;
      });

      btnRemoveRef.addEventListener('click', () => {
        const nodes = Array.from(root.children);
        const { ms } = time('remove()', () => {
          for (const n of nodes) n.remove();
        });
        out.textContent = `remove() t·ª´ng ph·∫ßn t·ª≠: ${ms} ms`;
        btnRemoveRef.disabled = true;
        btnRemoveClear.disabled = true;
      });

      btnRemoveClear.addEventListener('click', () => {
        const { ms } = time('innerHTML=""', () => { root.innerHTML = ''; });
        out.textContent = `innerHTML = "": ${ms} ms`;
        btnRemoveRef.disabled = true;
        btnRemoveClear.disabled = true;
      });
    })();
  </script>
</body>
</html>


